<?php
/**
 * FIXME: Edit Title Content
 *
 * FIXME: Edit Description Content
 *
 * Please do not edit this file. This file is part of the Cyber Chimps Framework and all modifications
 * should be made in a child theme.
 * FIXME: POINT USERS TO DOWNLOAD OUR STARTER CHILD THEME AND DOCUMENTATION
 *
 * @category Cyber Chimps Framework
 * @package  Framework
 * @since    1.0
 * @author   CyberChimps
 * @license  http://www.opensource.org/licenses/gpl-license.php GPL v2.0 (or later)
 * @link     http://www.cyberchimps.com/
 */

// Don't load directly
if ( !defined('ABSPATH') ) { die('-1'); }

add_action( 'magazine', 'magazine_element_content' );


function magazine_element_content() {
	global  $post;  // call globals	

	$box_no = get_post_meta($post->ID, 'no_of_box' , true);
	if( $box_no == 0 )
		$box_no = 2;
	elseif( $box_no == 1 )
		$box_no = 3;
	
	?>
	<div class="row-fluid">
		<?php
				$page_number = (get_query_var('paged')) ? get_query_var('paged') : 1;
				$magazine = new WP_Query(
									array(
										'paged'         => $page_number,
										'post_type'     => 'post',
										'orderby'       => 'post_date',
										'order'         => 'desc',
										'posts_per_page'=> 9,
										'post__not_in'  => $exclude_posts
									)
								);
			if($magazine ->post_count <= 6 && $box_no == 3)
			{
				$box_no = 2;
			}
		
		?>
		
		<div id="content">
			<div class="row-fluid">
				
				<?php
					/* Initializing counters. */
					$counter_post = 0; 
					$counter_box = 0;
					
				if ($magazine -> have_posts()) : while ($magazine -> have_posts()) : $magazine -> the_post();
					if( $counter_post < 2*$box_no )
					{ ?>
						<div class="post_container box_post span4">            
							<div <?php post_class() ?> id="post-<?php the_ID(); ?>">                
								<?php                
								if (get_post_format() == '') {
									$format = "default";
								}
								else {
									$format = get_post_format();
								} ?>
							
								<h2 class="posts_title"><a href="<?php the_permalink() ?>"><?php the_title(); ?></a></h2>
									
								<?php
								if ( has_post_thumbnail() ) {
									echo '<div class="featured-image">';
									echo '<a href="' . get_permalink($post->ID) . '" >';
										the_post_thumbnail('thumbnail');
									echo '</a>';
									echo '</div>';
								}
								?>	
								
								<div class="entry" <?php if ( has_post_thumbnail() ) { echo 'style="min-height: 115px;" '; }?>>
									<?php the_excerpt();    ?>
								</div><!--end entry-->  
							
								<div id="comments">
									<span class="comments-n-views"><?php comments_popup_link('No Comment', '1 Comment', '% Comments');?></span>
								</div>
							
								
								<!-- ************Links to share in social networks*********** -->	
								<div class="socialbar">
								
									<!-- Share in Facebook -->
									<a class="share-fb social"
										href="http://www.facebook.com/sharer.php?u=<?php the_permalink();?>&t=<?php the_title(); ?>"
										title="Share on Facebook" target="blank">Facebook</a>
									
									<!-- Twitt in Twitter -->
									<a class="share-twt social" 
										href="http://twitter.com/home?status=Currently reading <?php the_permalink(); ?>"
										title="Share on Twitter" target="_blank">Twitter</a>
									
									<!-- Share in LikedIn -->
									<a class="share-ln social" 
										href="http://www.linkedin.com/shareArticle?mini=true&url=<?php the_permalink() ?>&title=<?php the_title(); ?>&summary=&source=<?php bloginfo('name'); ?>" 
										target="_new">LinkedIn</a>
									
									<!-- Share in Reddit -->
									<a class="share-rdt social" 
										href="http://www.reddit.com/submit?url=<?php the_permalink();?>&title=<?php the_title(); ?>"
										target="blank">Reddit</a>
								</div>
														
							</div><!--end post_class-->
						</div><!--end post container-->
						<?php 
						$counter_box++;
						$counter_post++;
						if($box_no == $counter_box) {
							echo '</div><div class="row-fluid">';
							$counter_box = 0;
						}
						
						if( $counter_post == 6 && $box_no == 3 )
						{ ?>
							</div> </div> </div>	<!-- Ending "row-fluid" and "content" div -->
							
							<!-- Starting "content" and "row-fluid" div -->
							<div class="row-fluid">	
								<div id="content">
									<div class="row-fluid">	
						<?php
						}
					}
					else
					{ ?>
						<div class="post_container wide_post span8">
							<div <?php post_class() ?> id="post-<?php the_ID(); ?>">
								<h2 class="posts_title"><a href="<?php the_permalink() ?>"><?php the_title(); ?></a></h2>
								<?php
								if ( has_post_thumbnail() && $featured_images == '1') {
									echo '<div class="featured-image">';
									echo '<a href="' . get_permalink($post->ID) . '" >';
										the_post_thumbnail('thumbnail');
									echo '</a>';
									echo '</div>';
								}
								?>	
								<div class="entry" <?php if ( has_post_thumbnail() && $featured_images == '1' ) { echo 'style="min-height: 115px;" '; }?>>
									<?php 
										the_excerpt();
									 ?>
								</div><!--end entry-->  
								
								<div id="comments">
									<span class="comments-n-views"><?php comments_popup_link('No Comment', '1 Comment', '% Comments');?></span>
								</div>
						
								<!-- ************Links to share in social networks***********-->	
								<div class="socialbar">
								
									<!-- Share in Facebook -->
									<a class="share-fb social"
										href="http://www.facebook.com/sharer.php?u=<?php the_permalink();?>&t=<?php the_title(); ?>"
										title="Share on Facebook" target="blank">Facebook</a>
									
									<!-- Twitt in Twitter -->
									<a class="share-twt social" 
										href="http://twitter.com/home?status=Currently reading <?php the_permalink(); ?>" title="Share on Twitter" target="_blank">Twitter</a>
									
									<!-- Share in LikedIn -->
									<a class="share-ln social" href="http://www.linkedin.com/shareArticle?mini=true&url=<?php the_permalink() ?>&title=<?php the_title(); ?>&summary=&source=<?php bloginfo('name'); ?>" target="_new">LinkedIn</a>
									
									<!-- Share in Reddit -->
									<a class="share-rdt social" href="http://www.reddit.com/submit?url=<?php the_permalink();?>&title=<?php the_title(); ?>" target="blank">Reddit</a>
								</div>
								
								
								</div><!--end post_class-->
						</div><!--end post container-->
					<?php }	?>
					
					<?php endwhile;
					else : ?>
						<h2>Not Found</h2>
				<?php endif; ?>
				
			</div><!--end content-->
		</div>
		</div>
<?php	
}
?>