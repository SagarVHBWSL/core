<?php
/**
 * FIXME: Edit Title Content
 *
 * FIXME: Edit Description Content
 *
 * Please do not edit this file. This file is part of the Cyber Chimps Framework and all modifications
 * should be made in a child theme.
 * FIXME: POINT USERS TO DOWNLOAD OUR STARTER CHILD THEME AND DOCUMENTATION
 *
 * @category Cyber Chimps Framework
 * @package  Framework
 * @since    1.0
 * @author   CyberChimps
 * @license  http://www.opensource.org/licenses/gpl-license.php GPL v2.0 (or later)
 * @link     http://www.cyberchimps.com/
 */

// Don't load directly
if ( !defined('ABSPATH') ) { die('-1'); }

// Action for Featured Posts
add_action ('featured_posts', 'featured_posts_content' );

function featured_posts_content() {
	global  $post;  // call globals	
	
	// Getting featured post option values
	$post_source = get_post_meta($post->ID, 'cyberchimps_featured_post_category_toggle' , true);
	$post_category = get_post_meta($post->ID, 'cyberchimps_featured_post_category' , true);
	
	// Determine post category of query according to the options
	if( $post_source == 0 )
		$query_post_category = "";
	elseif( $post_source == 1 )
		$query_post_category = $post_category;
?>

	<div class="row-fluid">
		<div class="span8">
				
				
				<div class="headline_post" id="content-row">
				<div id="headline">
					<ul>
						<?php
						/* To keep the post ids for those are already displayed */
						$exclude_posts = array();
						
						$counter = 1;
						$the_query = new WP_Query(array('showposts' => -1, 'category_name' => $query_post_category, 
															'orderby' => 'post_date', 'order' => 'desc', 
															'post__not_in' => get_option( 'sticky_posts' ) 
															)); 					
						if ($the_query -> have_posts()) : while ($the_query -> have_posts()) : $the_query -> the_post();
						$exclude_posts[] = get_the_ID();
						
						$class = "featured" . $counter;
						$counter++;
						?>
							<li class="<?php echo $class; ?>">
								<div class="clearfloat">
									<?php if ( has_post_thumbnail() ) { ?>
									<a href="<?php the_permalink() ?>" class="headline-link headline-left">
										<?php the_post_thumbnail('headline-thumb',array('class'	=> 'headline-thumb')); ?>
									</a>
									<?php } ?>
									<div>
										<h1 class="title"><a rel="bookmark" href="<?php the_permalink() ?>"><?php the_title(); ?></a></h1>
									</div>
									<div class="meta">
										<span><?php echo get_the_time('F j, Y - g:i a '); ?></span> | 
										<span><?php comments_popup_link('No Comment', '1 Comment', '% Comments');?></span>
									</div><!--/.meta-->
									<?php 
									add_filter('excerpt_more', 'featured_post_excerpt_more'); 
									add_filter( 'excerpt_length', 'featured_post_length', 999 );
									the_excerpt();
									remove_filter('excerpt_more', 'featured_post_excerpt_more'); 
									remove_filter( 'excerpt_length', 'featured_post_length', 999 );
									?>
								</div><!--/.clearfloat-->
							</li>
							<?php 
							endwhile;
							wp_reset_query();
						endif 
						?>
					</ul>	
				</div>
			</div> <!-- End of Headline post-->
				
				
		</div>
		<div class="span4">
			
			
			<div class="newsscroll">
				<div id="featured">
					<ul id="mycarousel" class="jcarousel jcarousel-skin-response">
						<?php 
						$counter = 1;
						$featured_query = new WP_Query(array('showposts' => -1, 'category_name' => $query_post_category, 
															'orderby' => 'post_date', 'order' => 'desc', 
															'post__not_in' => get_option( 'sticky_posts' ) 
															));
						if ($featured_query -> have_posts()) : 
							while ($featured_query -> have_posts()) : $featured_query -> the_post();
							$id = "featured" . $counter;
							$counter++;
						?>
						<li id="<?php echo $id; ?>">
							<div class="clearfloat featured">
								<?php
								if ( has_post_thumbnail() ) {
									the_post_thumbnail('featured-thumb',array('class'	=> 'featured-thumb'));
								}?>                 
								<h5 class="featured-info">
									<?php the_title(); ?>
								</h5>
								<div class="featured-meta">
									<span class="date-n-time"><?php echo get_the_time('F j, Y - g:i a '); ?></span>
									<span class="comments-n-views"><?php comments_popup_link('No Comment', '1 Comment', '% Comments');?></span>
								</div>
							</div> 
						</li>
						<?php endwhile;
						wp_reset_query();
						endif ?>
					</ul>
				</div>
			</div>   
			
			
		</div>
	</div>
	
<?php
}
?>